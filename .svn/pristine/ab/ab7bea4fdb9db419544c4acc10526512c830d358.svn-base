ALTER TABLE TABPERFIL
ADD CPF_CLIENTE_BANCO VC15;;

CREATE TABLE TABEVENTO (
    CODIGO INTEIRO NOT NULL,
    NOME VC50);;

ALTER TABLE TABEVENTO
ADD CONSTRAINT PK_TABEVENTO
PRIMARY KEY (CODIGO);;

CREATE TABLE TABPEDIDOAGENDAMENTO (
    CODIGO INTEIRO NOT NULL,
    CODIGOPERFIL INTEIRO,
    CODIGOEVENTO INTEIRO,
    DATAEVENTO DATA,
    HORAEVENDO HORA,
    DSP_SEGUNDA INTEIRO,
    DSP_SEG_H1_I HORA,
    DSP_SEG_H1_F HORA,
    DSP_SEG_H2_I HORA,
    DSP_SEG_H2_F HORA,
    DSP_SEG_H3_I HORA,
    DSP_SEG_H3_F HORA,
    DSP_TERCA INTEIRO,
    DSP_TER_H1_I HORA,
    DSP_TER_H1_F HORA,
    DSP_TER_H2_I HORA,
    DSP_TER_H2_F HORA,
    DSP_TER_H3_I HORA,
    DSP_TER_H3_F HORA,
    DSP_QUARTA INTEIRO,
    DSP_QUA_H1_I HORA,
    DSP_QUA_H1_F HORA,
    DSP_QUA_H2_I HORA,
    DSP_QUA_H2_F HORA,
    DSP_QUA_H3_I HORA,
    DSP_QUA_H3_F HORA,
    DSP_QUINTA INTEIRO,
    DSP_QUI_H1_I HORA,
    DSP_QUI_H1_F HORA,
    DSP_QUI_H2_I HORA,
    DSP_QUI_H2_F HORA,
    DSP_QUI_H3_I HORA,
    DSP_QUI_H3_F HORA,
    DSP_SEXTA INTEIRO,
    DSP_SEX_H1_I HORA,
    DSP_SEX_H1_F HORA,
    DSP_SEX_H2_I HORA,
    DSP_SEX_H2_F HORA,
    DSP_SEX_H3_I HORA,
    DSP_SEX_H3_F HORA,
    DSP_SABADO INTEIRO,
    DSP_SAB_H1_I HORA,
    DSP_SAB_H1_F HORA,
    DSP_SAB_H2_I HORA,
    DSP_SAB_H2_F HORA,
    DSP_SAB_H3_I HORA,
    DSP_SAB_H3_F HORA,
    DSP_DOMINGO INTEIRO,
    DSP_DOM_H1_I HORA,
    DSP_DOM_H1_F HORA,
    DSP_DOM_H2_I HORA,
    DSP_DOM_H2_F HORA,
    DSP_DOM_H3_I HORA,
    DSP_DOM_H3_F HORA);;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD CONSTRAINT PK_TABPEDIDOAGENDAMENTO
PRIMARY KEY (CODIGO);;

CREATE SEQUENCE GEN_PEDIDO_AGENDA;;

CREATE TABLE TABACOMPANHANTESPEDIDOAGENDA (
    CODIGOPEDIDO INTEGER NOT NULL,
    ID INTEGER NOT NULL,
    CODIGOPERFIL INTEGER);;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD CONSTRAINT PK_TABACOMPANHANTESPEDIDOAGENDA
PRIMARY KEY (CODIGOPEDIDO,ID);;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD SITUACAO INTEIRO;;

ALTER TABLE TABTIPOMANEQUIM
ADD APLICACAO INTEIRO;;

ALTER TABLE TABPERFIL
ADD CPF_CLIENTE_BANCO VC15;;



CREATE TABLE TABTIPOMANEQUIMVALORPADRAO
(
CODIGOTIPOMANEQUIM INTEIRO NOT NULL,
VALORINICIAL NUMERICO2D NOT NULL,
VALORFINAL NUMERICO2D,
DESCRICAO VC200
);;

ALTER TABLE TABTIPOMANEQUIMVALORPADRAO
ADD CONSTRAINT PK_TABTIPOMANEQUIMVALORPADRAO
PRIMARY KEY (CODIGOTIPOMANEQUIM,VALORINICIAL);;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD DATACADASTRO DATA;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD VERSAO INTEIRO;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD CODIGOUSUARIO INTEIRO;;

CREATE TABLE TABAVALIACAO
(
CODIGO INTEIRO NOT NULL,
DESCRICAO VC200,
APLICACAO INTEIRO
);;

ALTER TABLE TABAVALIACAO
ADD CONSTRAINT PK_TABAVALIACAO
PRIMARY KEY (CODIGO);;

CREATE TABLE TABAVALIACAODETALHE
(
CODIGOAVALIACAO INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
DESCRICAO VC200,
VALOR NUMERICO2D
);;

ALTER TABLE TABAVALIACAODETALHE
ADD CONSTRAINT PK_TABAVALIACAODETALHE
PRIMARY KEY (CODIGOAVALIACAO,ID);;

CREATE TABLE TABAVALIACAOPERFIL
(
CODIGOORIGEM INTEIRO NOT NULL,
CODIGOAVALIACAO INTEIRO NOT NULL,
VALOR NUMERICO2D
);;

ALTER TABLE TABAVALIACAOPERFIL
ADD CONSTRAINT PK_TABAVALIACAOPERFIL
PRIMARY KEY (CODIGOORIGEM,CODIGOAVALIACAO);;

CREATE TABLE TABTIPOCONVIDADO (
    CODIGO CODIGO NOT NULL,
    NOME VC20);;

ALTER TABLE TABTIPOCONVIDADO
ADD CONSTRAINT PK_TABTIPOCONVIDADO
PRIMARY KEY (CODIGO);;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD CODIGOTIPOCONVIDADO INTEIRO;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD CODIGOTIPOCONVIDADO INTEIRO;;


CREATE TABLE TABQUESTIONARIO
(
CODIGO INTEIRO NOT NULL,
DESCRICAO VC200,
APLICACAO INTEIRO
);;

ALTER TABLE TABQUESTIONARIO ADD CONSTRAINT PK_TABQUESTIONARIO PRIMARY KEY (CODIGO);;

CREATE TABLE TABQUESTIONARIODETALHE
(
CODIGOQUESTIONARIO INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
VALORINICIAL NUMERICO2D,
VALORFINAL NUMERICO2D,
OPERACAO INTEIRO
);;

ALTER TABLE TABQUESTIONARIODETALHE
ADD CONSTRAINT PK_TABQUESTIONARIODETALHE
PRIMARY KEY (CODIGOQUESTIONARIO,ID);;

CREATE TABLE TABQUESTIONARIOAVALIACAO
(
CODIGOQUESTIONARIO INTEIRO NOT NULL,
CODIGOAVALIACAO INTEIRO NOT NULL,
OBSERVACAO VC200
);;

ALTER TABLE TABQUESTIONARIOAVALIACAO
ADD CONSTRAINT PK_TABQUESTIONARIOAVALIACAO
PRIMARY KEY (CODIGOQUESTIONARIO,CODIGOAVALIACAO);;

CREATE TABLE TABAVALIACAOPERFILGERAL
(
CODIGOORIGEM INTEIRO NOT NULL,
CODIGOQUESTIONARIO INTEIRO NOT NULL,
CODIGOUSUARIO INTEIRO,
DATA DATA,
HORA HORA);;

ALTER TABLE TABAVALIACAOPERFILGERAL
ADD CONSTRAINT PK_TABAVALIACAOPERFILGERAL
PRIMARY KEY (CODIGOORIGEM,CODIGOQUESTIONARIO);;

ALTER TABLE TABSITUACAOPRODUTO ADD APLICACAO INTEIRO;;

ALTER TABLE TABSITUACAOPRODUTO ADD OPERACAO INTEIRO;;

ALTER TABLE TABSITUACAOPRODUTO ADD DIASREAVALIACAO INTEIRO;;

ALTER TABLE TABSITUACAOPRODUTO
ADD CONSTRAINT PK_TABSITUACAOPRODUTO
PRIMARY KEY (CODIGO);;

CREATE TABLE TABHISTORICOSITUACAO
(
CODIGOORIGEM INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
TIPO INTEIRO,
DATA DATA,
HORA HORA,
CODIGOSITUACAO INTEIRO,
DESCRICAOSITUACAO VC100
);;

ALTER TABLE TABHISTORICOSITUACAO
ADD CONSTRAINT PK_TABHISTORICOSITUACAO
PRIMARY KEY (CODIGOORIGEM,ID);;

ALTER TABLE TABQUESTIONARIODETALHE ADD CODIGOSITUACAO INTEIRO;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD TIPO INTEIRO;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD CODIGOREGISTRO INTEIRO;;

CREATE TABLE TABCONFIGURACOES (
    FORM_NAME VC50 NOT NULL,
    CONFIG_NAME VC50 NOT NULL,
    CONFIG_CAPTION VC100,
    DESCRICAO VC200,
    TIPOCONFIG INTEIRO,
    VALOR_INTEIRO INTEIRO,
    VALOR_STRING VC200,
    VALOR_MEMO VC1000,
    VALOR_LOGICO INTEIRO,
    VALOR_DATA DATA,
    VALOR_HORA HORA,
    SQL_LOOKUP VC1000,
    DISPLAY_LOOKUP VC50,
    KEYVALUE_LOOKUP VC50);;

ALTER TABLE TABCONFIGURACOES
ADD CONSTRAINT PK_TABCONFIGURACOES
PRIMARY KEY (FORM_NAME,CONFIG_NAME);;

ALTER TABLE TABCONFIGURACOES
ADD VALORREAL NUMERICO6D;;

CREATE TABLE TABARARA (
    CODIGO INTEGER NOT NULL,
    DATAREGISTRO INTEGER,
    CODIGOAGENDA INTEGER);;

ALTER TABLE TABARARA
ADD CONSTRAINT PK_TABARARA
PRIMARY KEY (CODIGO);;

CREATE TABLE TABARARAPRODUTOS (
    CODIGOARARA INTEGER NOT NULL,
    CODIGOPRODUTO INTEGER NOT NULL)

ALTER TABLE TABARARAPRODUTOS
ADD CONSTRAINT PK_TABARARAPRODUTOS
PRIMARY KEY (CODIGOPRODUTO,CODIGOARARA);;

ALTER TABLE TABARARA
ADD CODIGOPERFIL INTEIRO;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD DATAMELHORDIA DATA;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD HORAMELHORDIA HORA;;

CREATE TABLE TABAGENDA (
    CODIGO CODIGO NOT NULL,
    DATA DATA,
    HORA HORA,
    IDPEDIDOAGENDA INTEIRO,
    IDPERFIL INTEIRO,
    CODIGOPRODUTO INTEIRO,
    DESCRICAO VC1000);;

ALTER TABLE TABAGENDA
ADD CONSTRAINT PK_TABAGENDA
PRIMARY KEY (CODIGO);;

ALTER TABLE TABAGENDA
ADD DATAFIM DATA;;

ALTER TABLE TABAGENDA
ADD HORAFIM HORA;;

ALTER TABLE TABAGENDA
ADD SITUACAO INTEIRO;;

ALTER TABLE TABAGENDA
ADD MOTIVOCANCELAMENTO VC200;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD OBSERVACOES VC100;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD DATAFIM DATA;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD HORAFIM HORA;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD RESULTADO NUMERICO2D;;

ALTER TABLE TABPERFIL ADD CODIGOSITUACAO INTEIRO;;

ALTER TABLE TABHISTORICOSITUACAO ADD DATAFIM DATA;;

ALTER TABLE TABHISTORICOSITUACAO ADD HORAFIM HORA;;

ALTER TABLE TABPRODUTOS ADD CODIGOSITUACAO INTEIRO;;

ALTER TABLE TABPEDIDOAGENDAMENTO DROP CODIGOTIPOCONVIDADO;;

ALTER TABLE TABPEDIDOAGENDAMENTO DROP CODIGOPERFIL;;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD TIPOAGENDAMENTO INTEIRO;;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD DATAMELHORDIA DATA;;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD HORAMELHORDIA HORA;;

ALTER TABLE TABPEDIDOAGENDAMENTO DROP DATAMELHORDIA;;

ALTER TABLE TABPEDIDOAGENDAMENTO DROP HORAMELHORDIA;;

ALTER TABLE TABACOMPANHANTESPEDIDOAGENDA
ADD OBSERVACOES VC200;;

ALTER TABLE TABPREFERENCIASPESSOAS
ADD CODIGOPEDIDO INTEIRO
DEFAULT 0 
NOT NULL ;;

UPDATE TABPREFERENCIASPESSOAS
SET CODIGOPEDIDO = 0
WHERE CODIGOPEDIDO IS NULL;;

ALTER TABLE TABPREFERENCIASPESSOAS DROP CONSTRAINT PK_TABPREFERENCIASPESSOAS;;

ALTER TABLE TABPREFERENCIASPESSOAS
ADD CONSTRAINT PK_TABPREFERENCIASPESSOAS
PRIMARY KEY (CODIGOPESSOA,CODIGOPREFERENCIA,CODIGOPEDIDO)
USING INDEX PK_TABPREFERENCIASPESSOAS;;

ALTER TABLE TABPESSOMANEQUIM
ADD CODIGOPEDIDO INTEIRO
DEFAULT 0 
NOT NULL ;;

UPDATE TABPESSOMANEQUIM
SET CODIGOPEDIDO = 0
WHERE CODIGOPEDIDO IS NULL;;

ALTER TABLE TABPESSOMANEQUIM DROP CONSTRAINT PK_TABPESSOMANEQUIM;;

ALTER TABLE TABPESSOMANEQUIM
ADD CONSTRAINT PK_TABPESSOMANEQUIM
PRIMARY KEY (CODIGOPERFIL,CODIGOTIPOMANEQUIM,CODIGOPEDIDO)
USING INDEX PK_TABPESSOMANEQUIM;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD CONTATO VC100;;

ALTER TABLE TABHISTORICOSITUACAO ADD CODIGOUSUARIO INTEIRO;;

CREATE SEQUENCE GEN_HISTORICO;;

CREATE TABLE TABORCAMENTO
(
CODIGO INTEIRO NOT NULL,
DATACADASTRO DATA,
CODIGOUSUARIO INTEIRO,
CODIGOCLIENTE INTEIRO,
OBSERVACOES VC100,
CODIGOSITUACAO INTEIRO,
CODIGOPEDIDO INTEIRO
);;

ALTER TABLE TABORCAMENTO ADD PRIMARY KEY(CODIGO);;


CREATE TABLE TABORCAMENTODETALHE
(
CODIGO INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
CODIGOPRODUTO INTEIRO,
VALOR NUMERICO2D
);;

ALTER TABLE TABORCAMENTODETALHE ADD PRIMARY KEY(CODIGO,ID);;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD TELEFONECONTATO VC20;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD EMAILCONTATO VC200;;

CREATE TABLE TABFORMAPAGAMENTO
(
CODIGO INTEIRO NOT NULL,
DESCRICAO VC100
);;

ALTER TABLE TABFORMAPAGAMENTO ADD PRIMARY KEY(CODIGO);;

ALTER TABLE TABHISTORICOSITUACAO ADD HISTORICOTRANSFERENCIA VARCHAR(500);;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD HORARIOEVENTO INTEIRO;;

ALTER TABLE TABPEDIDOAGENDAMENTO
ADD LOCALEVENTO VC200;;

ALTER TABLE TABAVALIACAOPERFILGERAL ADD CODIGOSITUACAO INTEIRO;;

CREATE TABLE TABARARADETALHE (
    CODIGOARARA INTEGER NOT NULL,
    CODIGOPRODUTO INTEGER NOT NULL);;

ALTER TABLE TABARARADETALHE
ADD CONSTRAINT PK_TABARARADETALHE
PRIMARY KEY (CODIGOARARA,CODIGOPRODUTO);;

ALTER TABLE TABTIPOFOTO
ADD USARNAARARA INTEIRO;;

update RDB$RELATION_FIELDS set
RDB$FIELD_SOURCE = 'DATA'
where (RDB$FIELD_NAME = 'DATAREGISTRO') and
(RDB$RELATION_NAME = 'TABARARA');;

CREATE TABLE TABCONTRATO
(
CODIGO INTEIRO NOT NULL,
DATA DATA,
DATARESERVA DATA,
HORARESERVA HORA,
CODIGOUSUARIO INTEIRO,
CODIGOCLIENTE INTEIRO,
OBSERVACOES VC100,
CODIGOORCAMENTO INTEIRO,
CODIGOARARA INTEIRO,
CODIGOSITUACAO INTEIRO,
CODIGOFORMAPAGAMENTO INTEIRO
);;

ALTER TABLE TABCONTRATO ADD PRIMARY KEY(CODIGO);;


CREATE TABLE TABCONTRATODETALHE
(
CODIGO INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
CODIGOPRODUTO INTEIRO,
VALOR NUMERICO2D
);;

ALTER TABLE TABCONTRATODETALHE ADD PRIMARY KEY(CODIGO,ID);;


CREATE TABLE TABMOVIMENTACAOCONTRATO
(
CODIGO INTEIRO NOT NULL,
ID INTEIRO NOT NULL,
DATA DATA,
CODIGOUSUARIO INTEIRO,
TIPO INTEIRO,
CODIGOREGISTRO INTEIRO
);;

ALTER TABLE TABMOVIMENTACAOCONTRATO ADD PRIMARY KEY(CODIGO,ID);;

CREATE TABLE TABSERVICO (
    CODIGO CODIGO NOT NULL,
    DECRICAO VC100,
    DETALHAMENTO VC1000);;

ALTER TABLE TABSERVICO
ADD CONSTRAINT PK_TABSERVICO
PRIMARY KEY (CODIGO);;

CREATE TABLE TABOS (
    CODIGO CODIGO NOT NULL,
    CODIGOUSUARIO INTEIRO,
    SITUACAO INTEIRO,
    NUMEROPRESTADOR VC20,
    DATA DATA,
    CODIGOPERFIL INTEIRO,
    CODIGOSERVICO INTEIRO,
    DATAINICIO DATA,
    HORAINICIO HORA,
    DATAFIM DATA,
    HORAFIM HORA,
    OBSERVACOES VC1000);;

ALTER TABLE TABOS
ADD CONSTRAINT PK_TABOS
PRIMARY KEY (CODIGO);;

CREATE TABLE TABOSDETALHE (
    CODIGOOS CODIGO NOT NULL,
    ID CODIGO NOT NULL,
    CODIGOPRODUTO INTEIRO,
    VALORSERVICO NUMERICO2D);;

ALTER TABLE TABOSDETALHE
ADD CONSTRAINT PK_TABOSDETALHE
PRIMARY KEY (CODIGOOS,ID);;

ALTER TABLE TABCONTRATO ADD CODIGOAGENDA INTEIRO;;

ALTER TABLE TABMOVIMENTACAOCONTRATO ADD HORA HORA;;

CREATE TABLE TABFINANCEIRO
(
 CODIGO INTEIRO NOT NULL,
 CODIGOUSUARIO INTEIRO,
 DATA DATA,
 DATAEMISSAO DATA,
 TIPO INTEIRO,
 CODIGOCLIENTE INTEIRO,
 OBSERVACOES VARCHAR(500)
);;

ALTER TABLE TABFINANCEIRO ADD PRIMARY KEY(CODIGO);;

CREATE TABLE TABFINANCEIRODETALHE
(
 CODIGO INTEIRO NOT NULL,
 PARCELA INTEIRO NOT NULL,
 DATAVENCIMENTO DATA,
 DATAPAGAMENTO DATA,
 CODIGOSITUACAO INTEIRO,
 VALOR NUMERICO4D,
 OBSERVACOES VARCHAR(500)
);;

ALTER TABLE TABFINANCEIRODETALHE ADD PRIMARY KEY(CODIGO,PARCELA);;

ALTER TABLE TABFINANCEIRO ADD CODIGOFORMAPAGAMENTO INTEIRO;;

CREATE TABLE TABCONTRATOTERCEIROS
(
CODIGO INTEIRO NOT NULL,
CODIGOFORNECEDOR INTEIRO,
CODIGOUSUARIO INTEIRO,
CODIGOSITUACAO INTEIRO,
DATACADASTRO DATA,
VERSAO INTEIRO,
OBSERVACOES VARCHAR(500)
);;

ALTER TABLE TABCONTRATOTERCEIROS ADD PRIMARY KEY(CODIGO);;

CREATE TABLE TABTEMP_ATENDIMENTO (
    CODIGOAGENDA INTEGER,
    CODIGOARARA INTEGER,
    COIGOPRODUTO INTEGER,
    TEMSERVICO INTEGER,
    CODIGOSERVICO INTEGER,
    CODIGOPRESTADOR INTEGER);;

ALTER TABLE TABTEMP_ATENDIMENTO
ADD OBSSERVICO VC200;;

ALTER TABLE TABORCAMENTO ADD CODIGOFORMAPAGAMENTO INTEIRO;;

ALTER TABLE TABORCAMENTO
ADD CODIGOAGENDA INTEIRO;;

ALTER TABLE TABOS
ADD CODIGOAGENDA INTEIRO;;

ALTER TABLE TABAVALIACAOPERFILGERAL DROP CONSTRAINT PK_TABAVALIACAOPERFILGERAL;;

ALTER TABLE TABAVALIACAOPERFIL DROP CONSTRAINT PK_TABAVALIACAOPERFIL;;

update RDB$RELATION_FIELDS set
RDB$NULL_FLAG = 1
where (RDB$FIELD_NAME = 'CODIGOREGISTRO') and
(RDB$RELATION_NAME = 'TABAVALIACAOPERFILGERAL');;

ALTER TABLE TABAVALIACAOPERFILGERAL
ADD CONSTRAINT PK_TABAVALIACAOPERFILGERAL
PRIMARY KEY (CODIGOREGISTRO);;

ALTER TABLE TABAVALIACAOPERFIL ALTER CODIGOORIGEM TO CODIGOREGISTRO;;

ALTER TABLE TABAVALIACAOPERFIL
ADD CONSTRAINT PK_TABAVALIACAOPERFIL
PRIMARY KEY (CODIGOREGISTRO,CODIGOAVALIACAO);;

ALTER TABLE TABHISTORICOSITUACAO ADD CODIGOAVALIACAO INTEIRO;;

ALTER TABLE TABHISTORICOSITUACAO DROP CONSTRAINT PK_TABHISTORICOSITUACAO;;

ALTER TABLE TABHISTORICOSITUACAO
ADD CONSTRAINT PK_TABHISTORICOSITUACAO
PRIMARY KEY (ID);;

ALTER TABLE TABCONTRATO ADD DATARETORNO DATA;;

ALTER TABLE TABCONTRATO ADD HORARETORNO HORA;;

CREATE VIEW VIEW_HISTORICOPRODUTO(
    DATAINICIO,
    DATAFIM,
    DATAHORAINICIO,
    DATAHORAFINAL,
    TIPO,
    NOMETIPO,
    CODIGOCLIENTE,
    NOMECLIENTE,
    CODIGOPRODUTO,
    NOMEPRODUTO,
    CODIGOREGISTRO,
    OBSERVACOES)
AS
SELECT X.DATAINICIO, X.DATAFIM,
       X.DATAHORAINICIO, X.DATAHORAFINAL, X.TIPO,
       CASE X.TIPO
         WHEN 1 THEN 'AGENDA'
         WHEN 2 THEN 'ALUGUEL'
         WHEN 3 THEN 'ORDEM DE SERVIÇO'
       END AS NOMETIPO,

       X.CODIGOCLIENTE, C.NOME AS NOMECLIENTE,

       X.CODIGOPRODUTO, P.DESCRICAO AS NOMEPRODUTO,

       X.CODIGOREGISTRO, X.OBSERVACOES


FROM (

SELECT A.DATA AS DATAINICIO, A.DATAFIM,
       CAST(A.DATA + A.HORA AS TIMESTAMP) AS DATAHORAINICIO,
       CAST(A.DATAFIM + A.HORAFIM AS TIMESTAMP) AS DATAHORAFINAL,
       1 AS TIPO,
       A.IDPERFIL CODIGOCLIENTE,
       D.CODIGOPRODUTO,

   A.CODIGO AS CODIGOREGISTRO,

   A.descricao AS OBSERVACOES

FROM TABAGENDA A
INNER JOIN TABARARA AR ON (A.CODIGO = AR.CODIGOAGENDA)
INNER JOIN TABARARADETALHE D ON (AR.CODIGO = D.CODIGOARARA)

WHERE A.situacao = 3




UNION ALL


SELECT C.DATARESERVA AS DATAINICIO, C.DATARETORNO AS DATAFIM,
       CAST(C.DATARESERVA + C.HORARESERVA AS TIMESTAMP) AS DATAHORAINICIO,
       CAST(C.DATARETORNO + C.HORARETORNO AS TIMESTAMP) AS DATAHORAFINAL,
       2 AS TIPO,
       C.CODIGOCLIENTE,
       D.CODIGOPRODUTO,

       C.CODIGO AS CODIGOREGISTRO,

       C.OBSERVACOES


 FROM TABCONTRATO C
INNER JOIN TABCONTRATODETALHE D ON (C.CODIGO = D.CODIGO)
 LEFT JOIN TABSITUACAOPRODUTO S ON (C.CODIGOSITUACAO = S.CODIGO)

 WHERE c.codigosituacao <> 4

UNION ALL


SELECT O.DATAINICIO, O.DATAFIM,
       CAST(O.DATAINICIO + O.HORAINICIO AS TIMESTAMP) AS DATAHORAINICIO,
       CAST(O.DATAFIM + O.HORAFIM AS TIMESTAMP) AS DATAHORAFINAL,
       3 TIPO,
       O.CODIGOPERFIL AS CODIGOCLIENTE,
       D.CODIGOPRODUTO,

       O.CODIGO AS CODIGOREGISTRO,

       O.OBSERVACOES


  FROM TABOS O
 INNER JOIN TABOSDETALHE D ON (O.CODIGO = D.CODIGOOS)


) X

LEFT JOIN TABPERFIL C ON (X.CODIGOCLIENTE = C.CODIGO)
LEFT JOIN TABPRODUTOS P ON (X.CODIGOPRODUTO = P.CODIGO)

ORDER BY 9, 3;;


CREATE TABLE TABFORMAPAGAMENTOPARCELAS
(
CODIGOFORMAPAGAMENTO INTEIRO NOT NULL,
PARCELA INTEIRO NOT NULL,
CODIGOTIPODOCUMENTO INTEIRO,
PORCENTAGEM NUMERICO2D,
DIASPARAVENCER INTEIRO
);;

ALTER TABLE TABFORMAPAGAMENTOPARCELAS ADD PRIMARY KEY(CODIGOFORMAPAGAMENTO,PARCELA);;

ALTER TABLE TABTIPODOCUMENTO ADD APLICACAO INTEIRO;;

ALTER TABLE TABFINANCEIRODETALHE ADD CODIGOTIPODOCUMENTO INTEIRO;;


CREATE TABLE TABPLANOCONTAS
(
  CODIGO VARCHAR(50) NOT NULL,
  NOME VARCHAR(500),
  CONTAMAE VARCHAR(50),
  NATUREZA INTEIRO,
  CODIGOAUXILIAR VARCHAR(50)
);;

ALTER TABLE TABPLANOCONTAS ADD PRIMARY KEY(CODIGO);;


CREATE TABLE TABCENTROCUSTO
(
CODIGO VARCHAR(50) NOT NULL,
NOME VARCHAR(500),
CONTAMAE VARCHAR(50),
CODIGOAUXILIAR VARCHAR(50)
);;

ALTER TABLE TABCENTROCUSTO ADD PRIMARY KEY(CODIGO);;

CREATE TABLE TABAPURACAOMENSAL
(
 CODIGO INTEIRO NOT NULL,
 DATA DATA,
 ANOMES VARCHAR(10),
 DESCRICAO VARCHAR(200),
 SALDOINICIAL NUMERICO2D,
 SALDOATUAL NUMERICO2D
);;

ALTER TABLE TABAPURACAOMENSAL ADD PRIMARY KEY(CODIGO);;

CREATE TABLE TABAPURACAOMENSALDETALHE
(
 CODIGOAPURACAO INTEIRO NOT NULL,
 ID INTEIRO NOT NULL,
 DATA DATA,
 VALORCREDITO NUMERICO2D,
 VALORDEBITO NUMERICO2D,
 SALDO NUMERICO2D,
 CODIGOCONTACONTABIL VARCHAR(20),
 CODIGOEXPLICACAO INTEIRO
);;

ALTER TABLE TABAPURACAOMENSALDETALHE ADD PRIMARY KEY(CODIGOAPURACAO,ID);;

CREATE TABLE TABEXPLICACAO
(
CODIGO INTEIRO NOT NULL,
DESCRICAO VARCHAR(200)
);;

ALTER TABLE TABEXPLICACAO ADD PRIMARY KEY(CODIGO);;

ALTER TABLE TABAPURACAOMENSALDETALHE ADD OBSERVACAO VARCHAR(500);;

ALTER TABLE TABPLANOCONTAS ADD TIPO INTEIRO;;

ALTER TABLE TABAPURACAOMENSAL ADD MES INTEIRO;;


CREATE TABLE TABPREVISAOORCAMENTO
(
  CODIGO INTEIRO NOT NULL,
  DATA DATA,
  DESCRICAO VARCHAR(200),
  ANO INTEIRO
);;

ALTER TABLE TABPREVISAOORCAMENTO ADD PRIMARY KEY(CODIGO);;

CREATE TABLE TABPREVISAOORCAMENTODETALHE
(
  CODIGOORCAMENTO INTEIRO NOT NULL,
  ID INTEIRO NOT NULL,
  CODIGOCONTACONTABIL VARCHAR(20) NOT NULL,
  DESCRICAO VARCHAR(200),
  VALORTOTAL NUMERICO2D,
  VALORMES01 NUMERICO2D,
  VALORMES02 NUMERICO2D,
  VALORMES03 NUMERICO2D,
  VALORMES04 NUMERICO2D,
  VALORMES05 NUMERICO2D,
  VALORMES06 NUMERICO2D,
  VALORMES07 NUMERICO2D,
  VALORMES08 NUMERICO2D,
  VALORMES09 NUMERICO2D,
  VALORMES10 NUMERICO2D,
  VALORMES11 NUMERICO2D,
  VALORMES12 NUMERICO2D
);;

ALTER TABLE TABPREVISAOORCAMENTODETALHE ADD PRIMARY KEY (CODIGOORCAMENTO,CODIGOCONTACONTABIL);;

CREATE OR ALTER procedure PROC_PRODUTO_COMPATIVEL_PEDIDO (
    CODIGOPRODUTO integer,
    CODIGOPEDIDO integer,
    CODIGOPERFIL integer)
returns (
    RESULTADO integer)
as
declare variable XPREFERENCIA integer;
declare variable XTIPO integer;
declare variable XOLDTIPO integer;
declare variable XRETORNO integer;
declare variable XTMPRETORNO integer;
declare variable REPROVADO integer;
declare variable XTIPOMANEQUIM integer;
declare variable VLRMANEQUIM numeric(15,2);
begin
  xtmpretorno = -1;
  XRETORNO = 0;
  Reprovado = 0;

  for Select PRF.codigopreferencia, PRF.tipo from tabpreferenciaspessoas prf
       where codigopedido = :CODIGOPEDIDO
         and codigopessoa = :CODIGOPERFIL
       order by 2,1
  into xPreferencia, xTipo
  do
  begin

    if ((XTMPRETORNO = 0) and (xoldtipo <> xtipo)) then
      Reprovado = 1;

    if ((((xoldtipo = xtipo) and (XTMPRETORNO = 0)) or
       ((xoldtipo <> xtipo) and (XTMPRETORNO = 1)) or
       (xtmpretorno = -1)) and (Reprovado = 0)) then
    begin
        select COUNT(*) from tabpreferenciasproduto prfp
         where prfp.codigoproduto = :codigoproduto
           and prfp.codigopreferencia = :xPreferencia
          into XTMPRETORNO;
    
        if (XTMPRETORNO > 0) then
          XRETORNO = 1;
        else
          XRETORNO = 0;
    end
    xoldtipo = xtipo;

  end

  -- verificando manequim
  if (xretorno = 1) then
  begin
      For Select pm.codigotipomanequim, pm.valor
            from tabpessomanequim pm
            left join tabtipomanequim tm on pm.codigotipomanequim = tm.codigo
           where tm.aplicacao = 3
             and pm.codigoperfil = :codigoperfil
      into xTipoManequim, vlrManequim
      do
      begin
        if (xretorno = 1) then
        begin
          Select Count(*) from tabprodutomanequim prm
           where prm.codigotipomanequim = :xTipoManequim
             and ((:vlrManequim between prm.valorinicial and prm.valorfinal) or (:vlrManequim = prm.valorinicial))
             and prm.codigoproduto = :codigoproduto
            into XTMPRETORNO;
    
            if (XTMPRETORNO > 0) then
              XRETORNO = 1;
            else
              XRETORNO = 0;
        end
      end
  end

  RESULTADO = xretorno;

  suspend;
end;;

